openapi: 3.0.3
info:
  title: Campus Event Calendar API
  version: 1.0.0
servers:
  - url: /api/v1

tags:
  - name: Auth
  - name: Users
  - name: Categories
  - name: Events
  - name: Bookmarks
  - name: Preferences
  - name: Timetables
  - name: Courses
  - name: Reviews
  - name: Tags
  - name: Competencies

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ErrorResponse:
      type: object
      properties:
        code: { type: string }
        message: { type: string }

    # ---------- Auth / Users ----------
    SignupRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string, format: email }
        password: { type: string }
        name: { type: string }

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string, format: email }
        password: { type: string }

    SocialLoginRequest:
      type: object
      required: [provider, idToken]
      properties:
        provider:
          type: string
          enum: [GOOGLE, APPLE, KAKAO, NAVER]
        idToken:
          type: string
          description: "OAuth provider에서 받은 ID token (또는 access token). 구현 방식에 맞춰 사용"
        name:
          type: string
          description: "소셜에서 받은 이름(선택)"

    AuthTokens:
      type: object
      properties:
        accessToken: { type: string }
        refreshToken:
          type: string
          nullable: true
          description: "refresh 토큰을 쓰면 반환. 안 쓰면 null 가능"

    MeResponse:
      type: object
      properties:
        id: { type: integer, format: int }
        email: { type: string, format: email }
        name: { type: string, nullable: true }
        profileImageUrl: { type: string, nullable: true }

    UpdateMeRequest:
      type: object
      properties:
        name: { type: string }
        profileImageUrl: { type: string }

    # ---------- Categories ----------
    CategoryGroupResponse:
      type: object
      properties:
        id: { type: integer, format: int }
        name: { type: string }
        sortOrder: { type: integer }

    CategoryResponse:
      type: object
      properties:
        id: { type: integer, format: int }
        groupId: { type: integer, format: int }
        name: { type: string }
        sortOrder: { type: integer }

    CategoryGroupWithCategoriesResponse:
      type: object
      properties:
        group:
          $ref: '#/components/schemas/CategoryGroupResponse'
        categories:
          type: array
          items: { $ref: '#/components/schemas/CategoryResponse' }

    # ---------- Events ----------
    EventSummary:
      type: object
      properties:
        id: { type: integer, format: int }
        title: { type: string }
        badge:
          type: string
          nullable: true
          description: "캘린더 미리보기 라벨(예: 시작 09:00, 마감 18:00). 서버가 만들어주면 프론트 편함"
        organization: { type: string, nullable: true }
        startAt: { type: string, format: date-time, nullable: true }
        endAt: { type: string, format: date-time, nullable: true }
        applyStart: { type: string, format: date-time, nullable: true }
        applyEnd: { type: string, format: date-time, nullable: true }
        statusId: { type: integer, format: int, nullable: true }
        eventTypeId: { type: integer, format: int, nullable: true }
        orgId: { type: integer, format: int, nullable: true }

    MonthViewDayBucket:
      type: object
      properties:
        total: { type: integer }
        preview:
          type: array
          items: { $ref: '#/components/schemas/EventSummary' }

    MonthViewResponse:
      type: object
      properties:
        range:
          type: object
          properties:
            from: { type: string, format: date }
            to: { type: string, format: date }
        byDate:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/MonthViewDayBucket'

    DayListResponse:
      type: object
      properties:
        date: { type: string, format: date }
        page: { type: integer }
        size: { type: integer }
        total: { type: integer }
        items:
          type: array
          items: { $ref: '#/components/schemas/EventSummary' }

    EventDetailResponse:
      allOf:
        - $ref: '#/components/schemas/EventSummary'
        - type: object
          properties:
            operationYear: { type: integer, nullable: true }
            operationSemester: { type: string, nullable: true }
            link: { type: string, nullable: true }
            bookmarkCount: { type: integer }
            isBookmarked:
              type: boolean
              description: "로그인한 경우에만 의미 있음"
            competencies:
              type: object
              properties:
                exCurricular:
                  type: array
                  items: { type: string }
                snuCore:
                  type: array
                  items: { type: string }

    # ---------- Preferences ----------
    InterestCategoryCreateRequest:
      type: object
      required: [categoryId]
      properties:
        categoryId: { type: integer, format: int }

    ExcludedKeywordCreateRequest:
      type: object
      required: [keyword]
      properties:
        keyword: { type: string }

    ExcludedKeywordUpdateRequest:
      type: object
      required: [keyword]
      properties:
        keyword: { type: string }

    ExcludedKeywordResponse:
      type: object
      properties:
        id: { type: integer, format: int }
        keyword: { type: string }
        createdAt: { type: string, format: date-time }

    # ---------- Timetables / Courses ----------
    SemesterEnum:
      type: string
      enum: [SPRING, SUMMER, FALL, WINTER]

    TimetableCreateRequest:
      type: object
      required: [name, year, semester]
      properties:
        name: { type: string }
        year: { type: integer }
        semester: { $ref: '#/components/schemas/SemesterEnum' }

    TimetableResponse:
      type: object
      properties:
        id: { type: integer, format: int }
        name: { type: string }
        year: { type: integer }
        semester: { $ref: '#/components/schemas/SemesterEnum' }

    CourseResponse:
      type: object
      properties:
        id: { type: integer, format: int }
        year: { type: integer }
        semester: { $ref: '#/components/schemas/SemesterEnum' }
        courseNumber: { type: string }
        lectureNumber: { type: string }
        courseTitle: { type: string }
        credit: { type: integer, format: int }
        instructor: { type: string, nullable: true }

    TimetableCourseAddRequest:
      type: object
      required: [courseId]
      properties:
        courseId: { type: integer, format: int }

    TimetableDetailResponse:
      allOf:
        - $ref: '#/components/schemas/TimetableResponse'
        - type: object
          properties:
            courses:
              type: array
              items:
                type: object
                properties:
                  timetableCourseId: { type: integer, format: int }
                  course: { $ref: '#/components/schemas/CourseResponse' }

    # ---------- Reviews / Tags ----------
    ReviewCreateRequest:
      type: object
      required: [eventId, content]
      properties:
        eventId: { type: integer, format: int }
        content: { type: string }
        tagIds:
          type: array
          items: { type: integer, format: int }

    ReviewUpdateRequest:
      type: object
      properties:
        content: { type: string }
        tagIds:
          type: array
          items: { type: integer, format: int }

    ReviewResponse:
      type: object
      properties:
        id: { type: integer, format: int }
        eventId: { type: integer, format: int }
        userId: { type: integer, format: int }
        content: { type: string }
        tags:
          type: array
          items:
            $ref: '#/components/schemas/TagResponse'
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    TagResponse:
      type: object
      properties:
        id: { type: integer, format: int }
        name: { type: string }

    # ---------- Competencies ----------
    CompetencyResponse:
      type: object
      properties:
        id: { type: integer, format: int }
        type: { type: string, enum: [EX_CURRICULAR, SNU_CORE] }
        name: { type: string }
        sortOrder: { type: integer }

paths:
  # ---------- Auth ----------
  /auth/signup:
    post:
      tags: [Auth]
      summary: Local 회원가입
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SignupRequest' }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthTokens' }
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }

  /auth/login:
    post:
      tags: [Auth]
      summary: Local 로그인
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthTokens' }

  /auth/social:
    post:
      tags: [Auth]
      summary: 소셜 로그인/가입 (provider + idToken)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SocialLoginRequest' }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthTokens' }

  /auth/logout:
    post:
      tags: [Auth]
      summary: 로그아웃
      security: [{ bearerAuth: [] }]
      responses:
        "204":
          description: No Content

  # ---------- Users ----------
  /users/me:
    get:
      tags: [Users]
      summary: 내 정보 조회
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MeResponse' }
    patch:
      tags: [Users]
      summary: 내 정보 수정
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateMeRequest' }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MeResponse' }

  # ---------- Categories ----------
  /categoryGroups:
    get:
      tags: [Categories]
      summary: 카테고리 그룹 + 카테고리 목록(드롭다운용)
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/CategoryGroupWithCategoriesResponse' }

  /categories:
    get:
      tags: [Categories]
      summary: 전체 카테고리 목록(옵션)
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/CategoryResponse' }

  # ---------- Events (Calendar) ----------
  /events/month:
    get:
      tags: [Events]
      summary: 월별 캘린더 조회(날짜별 묶음 + preview)
      parameters:
        - in: query
          name: from
          required: true
          schema: { type: string, format: date }
        - in: query
          name: to
          required: true
          schema: { type: string, format: date }
        - in: query
          name: statusId
          schema: { type: integer, format: int }
        - in: query
          name: eventTypeId
          schema: { type: integer, format: int }
        - in: query
          name: orgId
          schema: { type: integer, format: int }
        - in: query
          name: q
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MonthViewResponse' }

  /events/week:
    get:
      tags: [Events]
      summary: 주별 행사 리스트 조회
      parameters:
        - in: query
          name: start
          required: true
          schema: { type: string, format: date }
        - in: query
          name: statusId
          schema: { type: integer, format: int }
        - in: query
          name: eventTypeId
          schema: { type: integer, format: int }
        - in: query
          name: orgId
          schema: { type: integer, format: int }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: timetableId
          schema: { type: integer, format: int }
          description: "선택: 시간표 충돌 계산에 사용"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  range:
                    type: object
                    properties:
                      from: { type: string, format: date }
                      to: { type: string, format: date }
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/EventSummary' }

  /events/day:
    get:
      tags: [Events]
      summary: 일별 피드 조회(페이지네이션)
      parameters:
        - in: query
          name: date
          required: true
          schema: { type: string, format: date }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: size
          schema: { type: integer, default: 20 }
        - in: query
          name: statusId
          schema: { type: integer, format: int }
        - in: query
          name: eventTypeId
          schema: { type: integer, format: int }
        - in: query
          name: orgId
          schema: { type: integer, format: int }
        - in: query
          name: q
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/DayListResponse' }

  /events/{eventId}:
    get:
      tags: [Events]
      summary: 행사 상세 조회
      parameters:
        - in: path
          name: eventId
          required: true
          schema: { type: integer, format: int }
      security:
        - bearerAuth: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/EventDetailResponse' }

  # ---------- Bookmarks ----------
  /events/{eventId}/bookmark:
    post:
      tags: [Bookmarks]
      summary: 찜 저장
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: eventId
          required: true
          schema: { type: integer, format: int }
      responses:
        "204": { description: No Content }
    delete:
      tags: [Bookmarks]
      summary: 찜 취소
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: eventId
          required: true
          schema: { type: integer, format: int }
      responses:
        "204": { description: No Content }

  /users/me/bookmarks:
    get:
      tags: [Bookmarks]
      summary: 내가 찜한 행사 목록
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: size
          schema: { type: integer, default: 20 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  page: { type: integer }
                  size: { type: integer }
                  total: { type: integer }
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/EventSummary' }

  # ---------- Preferences ----------
  /users/me/interestCategories:
    get:
      tags: [Preferences]
      summary: 내 관심 카테고리 목록
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/CategoryResponse' }
    post:
      tags: [Preferences]
      summary: 관심 카테고리 추가
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/InterestCategoryCreateRequest' }
      responses:
        "204": { description: No Content }

  /users/me/interestCategories/{categoryId}:
    delete:
      tags: [Preferences]
      summary: 관심 카테고리 삭제
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: categoryId
          required: true
          schema: { type: integer, format: int }
      responses:
        "204": { description: No Content }

  /users/me/excludedKeywords:
    get:
      tags: [Preferences]
      summary: 내 제외 키워드 목록
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/ExcludedKeywordResponse' }
    post:
      tags: [Preferences]
      summary: 제외 키워드 추가
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ExcludedKeywordCreateRequest' }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ExcludedKeywordResponse' }

  /users/me/excludedKeywords/{excludedKeywordId}:
    patch:
      tags: [Preferences]
      summary: 제외 키워드 수정
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: excludedKeywordId
          required: true
          schema: { type: integer, format: int }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ExcludedKeywordUpdateRequest' }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ExcludedKeywordResponse' }
    delete:
      tags: [Preferences]
      summary: 제외 키워드 삭제
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: excludedKeywordId
          required: true
          schema: { type: integer, format: int }
      responses:
        "204": { description: No Content }

  # ---------- Timetables ----------
  /timetables:
    get:
      tags: [Timetables]
      summary: 내 시간표 목록
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: year
          schema: { type: integer }
        - in: query
          name: semester
          schema: { $ref: '#/components/schemas/SemesterEnum' }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/TimetableResponse' }
    post:
      tags: [Timetables]
      summary: 시간표 생성
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TimetableCreateRequest' }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/TimetableResponse' }

  /timetables/{timetableId}:
    get:
      tags: [Timetables]
      summary: 시간표 상세(강의 포함)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: timetableId
          required: true
          schema: { type: integer, format: int }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/TimetableDetailResponse' }
    delete:
      tags: [Timetables]
      summary: 시간표 삭제
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: timetableId
          required: true
          schema: { type: integer, format: int }
      responses:
        "204": { description: No Content }

  /timetables/{timetableId}/courses:
    post:
      tags: [Timetables]
      summary: 시간표에 강의 추가
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: timetableId
          required: true
          schema: { type: integer, format: int }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TimetableCourseAddRequest' }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  timetableCourseId: { type: integer, format: int }

  /timetables/{timetableId}/courses/{timetableCourseId}:
    delete:
      tags: [Timetables]
      summary: 시간표에서 강의 제거
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: timetableId
          required: true
          schema: { type: integer, format: int }
        - in: path
          name: timetableCourseId
          required: true
          schema: { type: integer, format: int }
      responses:
        "204": { description: No Content }

  # ---------- Courses ----------
  /courses:
    get:
      tags: [Courses]
      summary: 강의 목록/검색
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: year
          schema: { type: integer }
        - in: query
          name: semester
          schema: { $ref: '#/components/schemas/SemesterEnum' }
        - in: query
          name: q
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/CourseResponse' }

  # ---------- Reviews ----------
  /reviews:
    post:
      tags: [Reviews]
      summary: 후기 작성
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ReviewCreateRequest' }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ReviewResponse' }

  /users/me/reviews:
    get:
      tags: [Reviews]
      summary: 내가 작성한 후기 목록(태그 필터)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: tagId
          schema: { type: integer, format: int }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: size
          schema: { type: integer, default: 20 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  page: { type: integer }
                  size: { type: integer }
                  total: { type: integer }
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/ReviewResponse' }

  /reviews/{reviewId}:
    get:
      tags: [Reviews]
      summary: 후기 상세
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: reviewId
          required: true
          schema: { type: integer, format: int }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ReviewResponse' }
    patch:
      tags: [Reviews]
      summary: 후기 수정(내용/태그)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: reviewId
          required: true
          schema: { type: integer, format: int }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ReviewUpdateRequest' }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ReviewResponse' }
    delete:
      tags: [Reviews]
      summary: 후기 삭제
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: reviewId
          required: true
          schema: { type: integer, format: int }
      responses:
        "204": { description: No Content }

  # ---------- Tags ----------
  /tags:
    get:
      tags: [Tags]
      summary: 태그 목록/검색
      parameters:
        - in: query
          name: q
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/TagResponse' }

  # ---------- Competencies ----------
  /competencies:
    get:
      tags: [Competencies]
      summary: 역량 목록(비교과/학부대학)
      parameters:
        - in: query
          name: type
          schema:
            type: string
            enum: [EX_CURRICULAR, SNU_CORE]
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/CompetencyResponse' }

  # ---------- Health (optional) ----------
  /health:
    get:
      summary: Health check
      responses:
        "200":
          description: OK